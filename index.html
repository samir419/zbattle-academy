<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="samir.css">
	<link rel="stylesheet" href="zbattle.css">
	<style>
		html,body{
			margin: 0;
  			height: 100%;
		}
		#main{
			max-width:1080px;
			max-height: 620px;

			aspect-ratio: 16 / 9;

			width: min(100vw, calc(100vh * 16 / 9));
			height: min(100vh, calc(100vw * 9 / 16));

			overflow-y:auto;
		}
		.btn{
			padding:10px;
			margin:5px;
			width: fit-content;
			height:fit-content;
			color:var(--neutral-2);
			border-radius:10px;
			font-size: 16px;
			border:none;
		}
		#boiling-bar-container {
		    position: relative;
		    width: 300px;
		    height: 20px;
		    background: #222;
		}

		#boiling-bar {
		    height: 100%;
		    width: 0%;
		    background: white;
		}

		#boiling-target {
		    position: absolute;
		    top: 0;
		    height: 100%;
		    background: rgba(0,255,0,0.4);
		}
		.tab {
		    opacity: 0;
		    transition: opacity 1s ease;
		    display: none;
		}

		.tab.active {
		    display: flex;
		    opacity: 1;
		}

	</style>
</head>
<body>
	<div id="frame" class="flex one center outline screen column">
		<div id="main" class="flex column outline relative">

			<div id="notifs" class="flex full column absolute priority-1 scrollable-y" style="display:none;background-color:rgba(0,0,0,0.5)">
				<button onclick="document.getElementById('notifs').style.display='none'">close</button>
			</div>
			<div class="flex absolute priority-2" style="top: 0;right: 0;">
				<div id="date-time"></div>
				<button class="btn primary-bg" onclick="event_handler.broadcast({message:'open notifs'})" id="notif-button">notifs</button>
			</div>
			<div id="map" class="tab flex full outline center img-bg">
				<div class="flex full row">
					<div class="flex one column scrollable-y outline center" id="locations">
						<button class="btn primary-bg" onclick="switch_tab('dorm')">dorm</button>
						<button class="btn primary-bg " onclick="switch_tab('arena')">arena</button>
						<button class="btn primary-bg" onclick="switch_tab('shop')">shop</button>
						<button class="btn primary-bg" onclick="switch_tab('park')">park</button>
					</div>
					<div class="flex three img-bg column">
						<div class="flex row">
							<button class="btn primary-bg" onclick="document.getElementById('main').requestFullscreen()">fullscreen</button>
						</div>
						<img src="game assets/map.jpg" alt="" class="full">
					</div>
				</div>
			</div>

			<div id="dorm" class="tab flex full outline center img-bg">
				<div class="flex full column">
					<div class="flex row outline" id="dorm-tab-buttons">
						<button class="btn primary-bg">save</button>
						<button class="btn primary-bg">movesets</button>
						<button class="btn primary-bg">calendar</button>
						<button class="btn primary-bg">kitchen</button>
						<button class="btn primary-bg" onclick="switch_tab('map')">back to map</button>
					</div>
					<div id="dorm-save" class="flex full column">
						<div id="dorm-player-data"></div>
						<div id="dorm-items" class="flex full column"></div>
						<div>
							<button class="btn primary-bg" id="dorm-save-btn">save</button>
							<input type="file" name="" id="save-file-input">
							<button class="btn primary-bg" id="dorm-load-btn">load</button>
							<button class="btn primary-bg" onclick="">clear local storage</button>
						</div>
						<div>
							<button class="btn primary-bg" id="sleep-btn">sleep</button>
						</div>
					</div>
					<div id="dorm-movesets" class="flex full column">
						<h2>move sets</h2>
						<div id="player-movesets"></div>
						<div>
							<button class="btn primary-bg" id="create-moveset-btn">create new moveset</button>
						</div>
					</div>
					<div id="dorm-calendar" class="flex full column center">
						<h2>calendar</h2>
					</div>
					<div id="create-moveset-form" class="flex full column">
						<h2>create moveset</h2>
						<div class="flex full row" style="display:grid;grid-template-columns: 2fr 1fr;">
							<div id="available-move-list" class="flex row wrappable scrollable-y"></div>
							<div>
								<div id="selected-move-list" class="flex row wrappable"></div>
								<button class="btn primary-bg" id="finish-moveset-creation">finish</button>
							</div>
						</div>
					</div>
					<div id="kitchen" class="flex full column scrollable-y relative">
						<div id="food-info" class="flex column absolute priority-2" style="background-color:rgba(100,100,100,1)">
							<button style="right:0;" onclick="document.getElementById('food-info').style.display='none'">close</button>
							<div>
								<h3>food data</h3>
								<div id="food-data"></div>
							</div>
							<div>
								<h3>available actions</h3>
								<div id="food-actions"></div>
							</div>
							<div>
								<h3>send to</h3>
								<div id="food-locations"></div>
							</div>
						</div>
						<h2>kitchen</h2>
						<div class="flex row">
							<div class="flex one column outline scrollable-y">
								<h3>pot</h3>
								<div id="pot"></div>
								<button id="boil-button">boil</button>
								<div id="boiling-bar-container">
								    <div id="boiling-bar"></div>
								    <div id="boiling-target" class=""></div>
								</div>

								<button id="quick-time-button" style="display:'none'">quick time</button>
							</div>
							<div class="flex one column outline scrollable-y">
								<h3>chopping board</h3>
								<div id="chopping-board"></div>
							</div>
						</div>
						<div class="flex row">
							<div class="flex one column outline scrollable-y">
								<h3>storage</h3>
								<div id="food-raws"></div>
							</div>
							<div class="flex one column scrollable-y">
								<h3>plate</h3>
								<div id="plate" class="flex outline column"></div>
								<div id="food-stats" class="flex outline column"></div>
								<button id="serve-food">serve</button>
							</div>
							
						</div>
						
					</div>
				</div>
			</div>

			<div id="arena" class="tab flex full outline center scrollable-y img-bg">
				<div id="opponent-select" class="flex full column">
					<div class="flex row outline">
						<button class="btn primary-bg" onclick="switch_tab('map')">back to map</button>
					</div>
					<div class="flex full">
						<div class="flex two column outline">
							<h2>select opponent</h2>
							<div id="opponent-list" class="flex row wrappable"></div>
						</div>
						<div class="flex one column outline">
							<div class="flex one column scrollable-y">
								<h2>selected opponents</h2>
								<div id="selected-opponents" class="flex row wrappable"></div>
							</div>
							<div class="flex one column scrollable-y">
								<h2>selected allies</h2>
								<div id="selected-allies" class="flex row wrappable"></div>
							</div>
							<div class="flex full-width center">
								<button class="btn primary-bg" id="commence-battle">battle</button>
							</div>
						</div>
					</div>
				</div>
				<div id="moveset-select" class="flex full column">
					<h2>select move set</h2>
					<div id="arena-moveset-list"></div>
				</div>
				<div id="engine" class="flex full scrollable-y">
					<div id="game-ui" class="flex full-width"></div>
				</div>
			</div>

			<div id="shop" class="tab flex full outline center img-bg">
				<div class="flex full column">
					<div class="flex row outline" id="shop-tab-buttons">
						<button class="btn primary-bg">item shop</button>
						<button class="btn primary-bg">card shop</button>
						<button class="btn primary-bg">food market </button>
						<button class="btn primary-bg">gacha roulette</button>
						<button class="btn primary-bg" onclick="switch_tab('map')">back to map</button>
					</div>
					<div id="item-shop" class="flex full row scrollable-y">
						<div class="flex one column">
							<h2>buy items</h2>
							<div id="buyable-items"></div>
						</div>
						<div class="flex one column">
							<h2>sell items/foods</h2>
							<div id="sellable-items"></div>
						</div>
						<div class="flex one column">
							<div id="shop girl"></div>
						</div>
					</div>
					<div id="card-shop" class="flex full row scrollable-y">
						<div class="flex one column">
							<h2>buy cards</h2>
							<div id="buyable-cards"></div>
						</div>
						<div class="flex one column">
							<h2>sell cards</h2>
							<div id="sellable-cards"></div>
						</div>
						<div class="flex one column">
							<div id="shop boy"></div>
						</div>
					</div>
					<div id="food-market" class="flex full row scrollable-y">
						<div class="flex one column">
							<h2>buy foods</h2>
							<div id="buyable-foods"></div>
						</div>
						<div class="flex one column">
							<div id="shop woman"></div>
						</div>
					</div>
					<div id="shop-gacha-roullete" class="flex full column"></div>
				</div>
			</div>

			<div id="park" class="tab flex full outline center img-bg">
				<div class="flex full column">
					<div class="flex row outline" id="park-tab-buttons">
						<button class="btn primary-bg">tennis game</button>
						<button class="btn primary-bg">obstacle race</button>
						<button class="btn primary-bg" onclick="switch_tab('map')">back to map</button>
					</div>
					<div id="tennis-game" class="flex full column center">
						<div class="flex one row">
							<div class="flex one column center">
								<button class="btn primary-bg" onclick="ponggame.handle_input('q')">dash up</button>
								<div style="height:100px;width: 100px;border:solid;" id="up">move up</div>
								<div style="height:100px;width: 100px;border:solid;" id="down">move down</div>
								<button class="btn primary-bg" onclick="ponggame.handle_input('e')">dash down</button>
							</div>
							<div class="flex two column center">
								<canvas id="game-canvas" class="full-width"></canvas>
							</div>
							<div class="flex one column center">
								<div id="game-data">
		                            <div id="move-data">lorem ipsum</div>
		                        </div>
		                        <div class="flex row wrappable">
		                        	<button class="btn primary-bg" onclick="ponggame.start();">start</button>
		                            <button class="btn primary-bg" onclick="ponggame.state='running'">restart</button>
			                        <button class="btn primary-bg" onclick="ponggame.handle_input('p')">pause</button>
		                        </div>
								 <div class="flex row wrappable">
		                        	<button class="btn primary-bg" onclick="ponggame.handle_input('j')" id="special1">special 1</button>
                            		<button class="btn primary-bg" onclick="ponggame.handle_input('k')" id="special2">special 2</button>
                            		<button class="btn primary-bg" onclick="ponggame.handle_input('l')" id="special3">special 3</button>
                            		<button class="btn primary-bg" onclick="ponggame.handle_input('u')" id="special4">special 4</button>
		                        </div>
							</div>
						</div>
					</div>
					<div id="obstacle-race" class="flex full column center">
						<div class="flex one row">
							<div class="flex one column center">
								<div class="flex row center">
									<div style="height: 200px;width: 200px;border: solid;" id="obstacle-game-left">move left</div>
								</div>
							</div>
							<div class="flex four column center relative">
								<div id="obstacle-game-ui" class="flex center absolute full">
									<button class="btn primary-bg" onclick="document.getElementById('obstacle-game-ui').style.display='none';
										obstacle_game.init({players:[1]})">obstacle game</button>
								</div>
								<canvas id="obstacle-game-canvas" class="full-width"></canvas>
							</div>
							<div class="flex one column center">
								<button class="btn primary-bg" onclick="obstacle_game.pause()">pause</button>
								<div>
									<span id="obstacle-game-coin-count"></span>
									<span id="obstacle-game-score"></span>
								</div>
								<div class="flex row center">
									<div style="height: 200px;width: 200px;border: solid;" id="obstacle-game-right">move right</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			

		</div>
	</div>
	<script src="map.js"></script>
	<script src="notifs.js"></script>
	<script src="calendar.js"></script>
	<script src="dorm.js"></script>
	<script src="arena.js"></script>
	<script src="shop.js"></script>
	<script src="park.js"></script>
	<script src="battle engine/moves.js"></script>
	<script src="battle engine/zbattle.js"></script>
	<script src="battle engine/eventHandler.js"></script>
	<script src="z pong/classes.js"></script>
    <script src="z pong/moves.js"></script>
    <script src="z pong/pong.js"></script>
    <script src="z pong/controls.js"></script>
    <script src="obstacle race/game.js"></script>
    <script src="cookinggame/cookinggame.js"></script>
	<script>
		let username = 'player'
		if(!localStorage.getItem('zbattle academy data')){
		    username = prompt('enter your name')
		}
		game_data = {
			name:username,
			level:1,
			money:100,
			movesets:[
				['Strike','Heal','Blast Cannon','Repair','fusion xyz'],
			],
			available_moves:[
			    'Strike',
			    'Blast Cannon',
			    'Heal',
			    'Power Up',
			    'Repair',
			    'Attack Up',
			],
			items:[],
			time:{day:0,hour:0}

		}
		localStorage.setItem('zbattle academy data', JSON.stringify(game_data))
		if(localStorage.getItem('zbattle academy data')){
			game_data = JSON.parse(localStorage.getItem('zbattle academy data'))
		}else{
			localStorage.setItem('zbattle academy data', JSON.stringify(game_data))
		}
		localStorage.setItem('zbattle academy data', JSON.stringify(game_data))
		class event_brocker{
			constructor(){
				this.subscribers=[]
			}
			add_subscriber(obj){
				obj.event_handler = this
				this.subscribers.push(obj)
				//obj.elem.innerHTML+='added event handler'
			}
			broadcast(data){
				if(data.message=='switch'){
					switch_tab(data.tab)
				}
				if(data.message=='player victory'){
                    alert(data.name)
                }
                if(data.message=='restart'){
                    let quit = document.createElement('button');quit.className='primary'
                    quit.textContent='quit'
                    quit.onclick=()=>{
                        game.log_data.innerHTML = ''
                        game.current_turn = 0
                        game.players = []
                        game.player_queue = []
                        game.set_format()
                        document.getElementById('engine').style.display='none'
                        document.getElementById('menu').style.display='block'
                    }
                    game.ui.append(quit)
                }
                if(data.message=='newgame'){
                    document.getElementById('engine').style.display='none'
                    document.getElementById('menu').style.display='block'
                }
                if(data.message=='save data'){
                	localStorage.setItem('zbattle academy data', JSON.stringify(data.data))
                }
				this.subscribers.forEach(sub=>{
					sub.handle_event(data)
				})
			}
		}
		function switch_tab(tab) {
		    let tabs = document.querySelectorAll('.tab')

		    tabs.forEach(el => {
		        if (el.id === tab) {
		            el.classList.add('active')
		        } else {
		            el.classList.remove('active')
		        }
		    })

		    event_handler.broadcast({ message: 'tab switch', tab: tab })
		}
		let event_handler = new event_brocker()
		let map = new Map(document.getElementById('map'))
		let dorm = new Dorm(document.getElementById('dorm'))
		let arena = new Arena(document.getElementById('arena'))
		let shop = new Shop(document.getElementById('shop'))
		let notif = new Notif()
		let calendar = new Calendar()
		let park = new Park(document.getElementById('park'))
		event_handler.add_subscriber(map)
		event_handler.add_subscriber(dorm)
		event_handler.add_subscriber(arena)
		event_handler.add_subscriber(shop)
		event_handler.add_subscriber(notif)
		event_handler.add_subscriber(calendar)
		event_handler.add_subscriber(park)
		event_handler.add_subscriber(ponggame)
		switch_tab('map')
		let game = new Game()
		event_handler.add_subscriber(game)
		event_handler.add_subscriber(obstacle_game)
		arena.init(game)
	</script>
</body>
</html>										